(()=>{var e={9590:e=>{var t="undefined"!=typeof Element,n="function"==typeof Map,r="function"==typeof Set,o="function"==typeof ArrayBuffer&&!!ArrayBuffer.isView;function i(e,s){if(e===s)return!0;if(e&&s&&"object"==typeof e&&"object"==typeof s){if(e.constructor!==s.constructor)return!1;var a,u,c,l;if(Array.isArray(e)){if((a=e.length)!=s.length)return!1;for(u=a;0!=u--;)if(!i(e[u],s[u]))return!1;return!0}if(n&&e instanceof Map&&s instanceof Map){if(e.size!==s.size)return!1;for(l=e.entries();!(u=l.next()).done;)if(!s.has(u.value[0]))return!1;for(l=e.entries();!(u=l.next()).done;)if(!i(u.value[1],s.get(u.value[0])))return!1;return!0}if(r&&e instanceof Set&&s instanceof Set){if(e.size!==s.size)return!1;for(l=e.entries();!(u=l.next()).done;)if(!s.has(u.value[0]))return!1;return!0}if(o&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(s)){if((a=e.length)!=s.length)return!1;for(u=a;0!=u--;)if(e[u]!==s[u])return!1;return!0}if(e.constructor===RegExp)return e.source===s.source&&e.flags===s.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===s.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===s.toString();if((a=(c=Object.keys(e)).length)!==Object.keys(s).length)return!1;for(u=a;0!=u--;)if(!Object.prototype.hasOwnProperty.call(s,c[u]))return!1;if(t&&e instanceof Element)return!1;for(u=a;0!=u--;)if(("_owner"!==c[u]&&"__v"!==c[u]&&"__o"!==c[u]||!e.$$typeof)&&!i(e[c[u]],s[c[u]]))return!1;return!0}return e!=e&&s!=s}e.exports=function(e,t){try{return i(e,t)}catch(e){if((e.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw e}}},5251:(e,t,n)=>{"use strict";var r=n(9196),o=Symbol.for("react.element"),i=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,n){var r,u={},c=null,l=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(l=t.ref),t)i.call(t,r)&&!a.hasOwnProperty(r)&&(u[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===u[r]&&(u[r]=t[r]);return{$$typeof:o,type:e,key:c,ref:l,props:u,_owner:s.current}}},5893:(e,t,n)=>{"use strict";e.exports=n(5251)},4670:(e,t,n)=>{"use strict";e.exports=n(5607)},9829:(e,t,n)=>{"use strict";var r,o,i,s=n(8946),a="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function u(){i=!1}function c(e){if(e){if(e!==r){if(e.length!==a.length)throw new Error("Custom alphabet for shortid must be "+a.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter((function(e,t,n){return t!==n.lastIndexOf(e)}));if(t.length)throw new Error("Custom alphabet for shortid must be "+a.length+" unique characters. These characters were not unique: "+t.join(", "));r=e,u()}}else r!==a&&(r=a,u())}function l(){return i||(i=function(){r||c(a);for(var e,t=r.split(""),n=[],o=s.nextValue();t.length>0;)o=s.nextValue(),e=Math.floor(o*t.length),n.push(t.splice(e,1)[0]);return n.join("")}())}e.exports={get:function(){return r||a},characters:function(e){return c(e),r},seed:function(e){s.seed(e),o!==e&&(u(),o=e)},lookup:function(e){return l()[e]},shuffled:l}},480:(e,t,n)=>{"use strict";var r,o,i=n(8416);n(9829),e.exports=function(e){var t="",n=Math.floor(.001*(Date.now()-1567752802062));return n===o?r++:(r=0,o=n),t+=i(7),t+=i(e),r>0&&(t+=i(r)),t+i(n)}},8416:(e,t,n)=>{"use strict";var r=n(9829),o=n(3766),i=n(296);e.exports=function(e){for(var t,n=0,s="";!t;)s+=i(o,r.get(),1),t=e<Math.pow(16,n+1),n++;return s}},5607:(e,t,n)=>{"use strict";var r=n(9829),o=n(480),i=n(1082),s=n(5636)||0;function a(){return o(s)}e.exports=a,e.exports.generate=a,e.exports.seed=function(t){return r.seed(t),e.exports},e.exports.worker=function(t){return s=t,e.exports},e.exports.characters=function(e){return void 0!==e&&r.characters(e),r.shuffled()},e.exports.isValid=i},1082:(e,t,n)=>{"use strict";var r=n(9829);e.exports=function(e){return!(!e||"string"!=typeof e||e.length<6||new RegExp("[^"+r.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(e))}},3766:e=>{"use strict";var t,n="object"==typeof window&&(window.crypto||window.msCrypto);t=n&&n.getRandomValues?function(e){return n.getRandomValues(new Uint8Array(e))}:function(e){for(var t=[],n=0;n<e;n++)t.push(Math.floor(256*Math.random()));return t},e.exports=t},8946:e=>{"use strict";var t=1;e.exports={nextValue:function(){return(t=(9301*t+49297)%233280)/233280},seed:function(e){t=e}}},5636:e=>{"use strict";e.exports=0},296:e=>{e.exports=function(e,t,n){for(var r=(2<<Math.log(t.length-1)/Math.LN2)-1,o=-~(1.6*r*n/t.length),i="";;)for(var s=e(o),a=o;a--;)if((i+=t[s[a]&r]||"").length===+n)return i}},9196:e=>{"use strict";e.exports=window.React}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{"use strict";n.r(r),n.d(r,{MENU_ITEM_BLOCK:()=>g,MenuEntityProvider:()=>I,createPrimaryMenu:()=>S,generateItemInitialData:()=>M,gutentagMenuEntity:()=>p,useMenuBlockEditor:()=>E,useMenusLocations:()=>j,usePrimaryMenuBlockEditor:()=>L});const e=window.kubio.globalData,t=window.wp.apiFetch;var o=n.n(t);const i=window.wp.blocks,s=window.wp.data,a=window.wp.element,u=window.wp.i18n,c=window.lodash;var l=n(9590),d=n.n(l),f=n(4670);const p={name:"menu",kind:"kubio",baseURL:"/kubio/v1/menu",plural:"menus",label:(0,u.__)("Menu","kubio"),mergedEdits:{meta:!0},getTitle:e=>{var t;return(0,c.isString)(null===(t=e)||void 0===t?void 0:t.data)&&(e=JSON.parse(e.data)),(0,c.get)(e,"menu.name",(0,u.__)("Menu Title","kubio"))}},g="kubio/menu-item";var v=n(5893);const h={},m=(0,f.generate)();let y=(0,f.generate)();const w=()=>(h.context||(h.context=(0,a.createContext)()),h);function b(){var e;return null===(e=(0,a.useContext)(w().context))||void 0===e?void 0:e.id}const M=()=>{const e=-1*Date.now();return{id:e,parent:0,type:"custom",objectId:e,label:"",url:"",target:""}},R={content:{},isResolving:!1,hasResolved:!1,lastChange:m};function x(e,t={}){const n=b(),r=null!=e?e:n,{editedEntity:o,isResolving:i,hasResolved:u}=(0,s.useSelect)((e=>r<0?{editedEntity:null,isResolving:!1,hasResolved:!0}:{editedEntity:e("core").getEditedEntityRecord(p.kind,p.name,r,t),isResolving:e("core").isResolving("getEditedEntityRecord",[p.kind,p.name,r,t]),hasResolved:e("core").hasFinishedResolution("getEditedEntityRecord",[p.kind,p.name,r,t])})),c=null==o?void 0:o.lastChange,l=null==o?void 0:o.data;return(0,a.useMemo)((()=>!parseInt(r)&&r<0?R:{content:l&&JSON.parse(l),isResolving:i,hasResolved:u,lastChange:c||m}),[r,l,i,u,c])}function k(e,t,n={}){const r=b(),o=null!=t?t:r,{content:i,lastChange:u}=x(o,n),c=(0,a.useMemo)((()=>i&&i[e]),[i,e]),l=(0,a.useMemo)((()=>i&&(i.lastReloadUID||"")),[i]),{editEntityRecord:g}=(0,s.useDispatch)("core");return[c,(0,a.useCallback)(((t,n=!1)=>{const r={...i,[e]:t,lastReloadUID:n?(0,f.generate)():i.lastReloadUID};if("items"===e){const e=[...i.items||[]].sort(((e,t)=>e.id-t.id)),n=[...t||[]].sort(((e,t)=>e.id-t.id));if(d()(e,n))return}g(p.kind,p.name,o,{data:JSON.stringify(r),lastChange:(0,f.generate)()})}),[o,e,i]),u,l]}const _=(e,t=0)=>(0,c.isArray)(e)?e.filter((e=>e.parent===t&&!(0,c.isUndefined)(e.id))).sort(((e,t)=>e.order-t.order)).map((({id:t,parent:n,label:r,url:o,target:s,object:a,type:u,objectId:c})=>(0,i.createBlock)(g,{id:t,parent:n,label:r,url:o,target:s,object:a,type:u,objectId:c},_(e,t)))):[],E=(e,t={})=>{const n=b(),r=null!=e?e:n,{isResolving:o,hasResolved:i}=x(r,t),[s,u,l,f]=k("items",r,t),[p,g]=k("menu",r,t),v=(0,a.useCallback)((e=>{const t=(e=>{let t=0;const n=(e,r=0)=>(0,c.flatten)(e.map((({attributes:e,innerBlocks:o})=>{const i=(0,c.merge)(M(),e);return t++,[{...(0,c.omit)(i,"kubio"),order:t,parent:r},...n(o,e.id)]})));return n(e)})(e);d()(s,t)||u(t)}),[u,s]);return{id:r,items:s,setItems:u,onChange:v,menu:p,setMenu:g,onInput:c.noop,itemsToBlocks:_,isResolving:o,hasResolved:i,lastChangeUID:l,lastReloadUID:f}},O=()=>(0,s.select)("core/block-editor").getSettings().kubioPrimaryMenuLocation,L=()=>{const e=O(),{getMenuLocations:t}=j(),n=t(),r=(0,a.useMemo)((()=>{var t;return null===(t=(0,c.find)(n,{name:e}))||void 0===t?void 0:t.menu}),[(null==n?void 0:n.length)||0]);return{...E(r),exists:!!r}},S=async(e=(0,u.__)("Main menu","kubio"))=>{const{saveMenu:t}=(0,s.dispatch)("core"),n=await t({name:e}),r=O();let i=null;n&&(i=n.id,await o()({path:"kubio/v1/menu/save-menu-location",method:"POST",data:{location:r,id:i}}),y=(0,f.generate)(),await(0,s.select)("core").getMenuLocations({_:y}))},j=()=>{const{menuLocations:t,setMenuLocations:n}=(0,e.useGlobalDataMenuLocations)(),{getMenuLocations:r,isResolvingLocation:o,hasResolvedLocations:i}=(0,s.useSelect)((e=>({getMenuLocations:e("core").getMenuLocations,isResolvingLocation:e("core").isResolving("getMenuLocations"),hasResolvedLocations:e("core").hasFinishedResolution("getMenuLocations")})));return{menuLocations:t||[],getMenuLocations:r,isResolvingLocation:o,hasResolvedLocations:i,updateLocationMenu:(e,r)=>{const o=t.map((t=>{const n={...t};return n.name===e&&(n.menu=parseInt(r)),n}));n(o)}}},I=({id:e,children:t})=>{const n=w().context.Provider,r=(0,a.useMemo)((()=>({id:e})),[e]);return(0,v.jsx)(n,{value:r,children:t})};(()=>{const e=(0,s.subscribe)((()=>{const t=(0,s.select)("core"),n=(0,s.dispatch)("core");if(!t||!n)return;const r=t.getEntitiesConfig("kubio"),{addEntities:o}=n;(0,c.find)(r,{name:p.name})||(o([p]),e())}))})()})(),(window.kubio=window.kubio||{}).menuData=r})();
